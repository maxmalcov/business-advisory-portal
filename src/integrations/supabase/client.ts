// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://grpzctxumndpwdwzgzqt.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdycHpjdHh1bW5kcHdkd3pnenF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM3Njc3NTUsImV4cCI6MjA1OTM0Mzc1NX0.au6WCg30IA9bx4-5MdapzytvS-AJoet5dFyPOIzHopw";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

// Type definitions for service requests to avoid TypeScript errors
// This is a workaround until the types.ts file is automatically regenerated
export type ServiceRequest = {
  id: string;
  service_id: string;
  service_name: string;
  client_id: string;
  client_name: string;
  request_date: string;
  status: string;
  admin_notes?: string | null;
  updated_at: string;
}

// Type definition for services - updated to match the database schema
export type Service = {
  id: string;
  title: string;
  description: string;
  price: number;
  iconName: string; // We keep this as camelCase for the frontend
  iconname?: string; // Database column is lowercase
  badges: string[];
  popular: boolean;
  category?: string | null;
  status: 'active' | 'inactive';
  created_at: string;
  updated_at: string;
}

// Type definition for employees - matches the database schema
export type Employee = {
  id: string;
  full_name: string;
  position: string;
  status: 'active' | 'terminated';
  start_date: string;
  end_date?: string | null;
  created_at?: string;
  updated_at?: string;
}

// Helper function to safely access the service_requests table
export const serviceRequestsTable = () => {
  return supabase.from('service_requests');
};

// Helper function to safely access the services table
// This is a workaround because the services table isn't in the generated types yet
export const servicesTable = () => {
  // Force TypeScript to treat this as any to bypass type checking
  // since we're manually defining the Service type above
  return supabase.from('services' as any);
};

// Helper function to safely access the employees table
export const employeesTable = () => {
  // Force TypeScript to treat this as any to bypass type checking
  // since we're manually defining the Employee type above
  return supabase.from('employees' as any);
};

// Setup realtime subscription for the service_requests table
// We're removing the problematic RPC call and using direct channel subscription instead
const setupRealtimeSubscription = () => {
  try {
    console.log('Setting up realtime subscription for service_requests table');
    
    // Instead of trying to call a DB function, we'll just subscribe to the channel directly
    const channel = supabase
      .channel('service_requests_changes')
      .on('postgres_changes', {
        event: '*',
        schema: 'public',
        table: 'service_requests'
      }, (payload) => {
        console.log('Realtime change received:', payload);
      })
      .subscribe((status) => {
        console.log(`Realtime subscription status: ${status}`);
      });
      
    return channel;
  } catch (err) {
    console.error('Failed to setup realtime subscription:', err);
    return null;
  }
};

// Initialize realtime subscription
setupRealtimeSubscription();
